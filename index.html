<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vision-Itaca ‚Äî Pr√≥ximamente</title>
  <meta name="description" content="Vision-Itaca ‚Äî Sitio en desarrollo. Mientras tanto, juega Snake, Pong, Breakout, 2048." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0f;
      --bg-soft: #11111a;
      --bg-soft-2: #151523;
      --text: #eae6ff;
      --muted: #b9b2e6;
      --accent: #a78bfa; /* violet-400 */
      --accent-2: #7c3aed; /* violet-600 */
      --accent-3: #c4b5fd; /* violet-300 */
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 10px 40px rgba(124, 58, 237, 0.25), 0 2px 12px rgba(167, 139, 250, 0.15);
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--text);
      background: radial-gradient(1200px 800px at 80% -20%, rgba(124,58,237,0.14), transparent 60%),
                  radial-gradient(1200px 800px at -10% 120%, rgba(167,139,250,0.10), transparent 60%),
                  linear-gradient(180deg, #0a0a0f 0%, #0c0c14 100%);
    }
    .container { max-width: 1080px; margin: 0 auto; padding: 32px 16px 64px }
    header { text-align: center; margin-top: 12px; margin-bottom: 28px }
    .brand {
      font-size: clamp(28px, 6vw, 56px);
      font-weight: 800; letter-spacing: 0.5px;
      text-shadow: 0 1px 0 #000, 0 8px 30px rgba(167,139,250,0.35);
    }
    .sub { font-size: clamp(16px, 3vw, 22px); color: var(--accent-3); margin-top: 4px }
    .note {
      margin: 16px auto 28px; max-width: 820px; line-height: 1.5;
      color: var(--muted); background: linear-gradient(180deg, rgba(124,58,237,0.15), rgba(124,58,237,0.08));
      border: 1px solid rgba(167,139,250,0.35); padding: 12px 16px; border-radius: 14px;
      box-shadow: var(--shadow);
    }
    /* Tabs */
    .tabs { display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap; margin: 12px 0 4px }
    .tab-btn {
      appearance: none; border: 1px solid rgba(167,139,250,0.45); background: linear-gradient(180deg, #151523, #131327);
      color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; letter-spacing: .2px;
      transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .tab-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow); }
    .tab-btn.active { border-color: var(--accent-2); box-shadow: inset 0 0 0 1px var(--accent-2), 0 10px 30px rgba(124,58,237,.25) }
    .frame {
      margin-top: 18px; background: linear-gradient(180deg, #0f0f1a, #0e0e17);
      border: 1px solid rgba(167,139,250,.3); border-radius: 18px; padding: 16px; box-shadow: var(--shadow);
    }
    .game-wrap { display: none }
    .game-wrap.active { display: block; }

    .canvas-wrap { display: flex; flex-direction: column; align-items: center; gap: 8px }
    canvas { background: #05050a; border-radius: 12px; border: 1px solid rgba(167,139,250,.25); box-shadow: inset 0 0 40px rgba(124,58,237,0.12) }
    .hud { display: flex; gap: 14px; flex-wrap: wrap; justify-content: center; align-items: center; margin-top: 6px }
    .pill {
      background: #121225; border: 1px solid rgba(167,139,250,.35); padding: 6px 10px; border-radius: 999px; font-size: 14px;
      color: var(--accent-3)
    }
    .ctrls { text-align: center; color: var(--muted); font-size: 13px; margin-top: 8px }
    .actions { display: flex; justify-content: center; gap: 8px; margin: 8px 0 2px }
    .btn {
      border: 1px solid rgba(167,139,250,.5); background: #141428; color: var(--text); padding: 8px 12px; border-radius: 10px; cursor: pointer;
      font-weight: 600
    }
    .btn:hover { box-shadow: 0 6px 18px rgba(124,58,237,.25) }

    /* 2048 */
    .grid-2048 { width: 320px; margin: 0 auto; display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; background: #0b0b14; padding: 8px; border-radius: 12px; border: 1px solid rgba(167,139,250,.25) }
    .cell { height: 70px; display: grid; place-items: center; font-weight: 800; font-size: 24px; border-radius: 10px; background: #121225; color: var(--text); border: 1px solid rgba(167,139,250,.2) }
    .legend { text-align: center; margin-top: 8px; color: var(--muted); font-size: 13px }

    footer { margin-top: 30px; text-align: center; color: var(--muted); font-size: 12px; opacity: .85 }
    a { color: var(--accent) }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">Vision-Itaca</div>
      <div class="sub">Pr√≥ximamente...</div>
      <div class="note">Sitio en desarrollo ‚Äî mientras tanto, puedes jugar a estos juegos üëá</div>
    </header>

    <nav class="tabs" role="tablist" aria-label="Juegos">
      <button class="tab-btn active" data-tab="snake" role="tab" aria-selected="true">üêç Snake</button>
      <button class="tab-btn" data-tab="pong" role="tab" aria-selected="false">üèì Pong</button>
      <button class="tab-btn" data-tab="breakout" role="tab" aria-selected="false">üß± Breakout</button>
      <button class="tab-btn" data-tab="2048" role="tab" aria-selected="false">üî¢ 2048</button>
    </nav>

    <section class="frame">
      <!-- SNAKE -->
      <div class="game-wrap active" id="tab-snake" role="tabpanel" aria-labelledby="Snake">
        <div class="canvas-wrap">
          <canvas id="snakeCanvas" width="480" height="360"></canvas>
          <div class="hud">
            <span class="pill">Puntos: <strong id="sn-score">0</strong></span>
            <span class="pill">M√°xima: <strong id="sn-best">0</strong></span>
            <span class="pill">Velocidad: <strong id="sn-speed">1x</strong></span>
          </div>
          <div class="actions">
            <button class="btn" id="sn-restart">Reiniciar</button>
          </div>
          <div class="ctrls">Controles: Flechas o WASD. Pausa: P</div>
        </div>
      </div>

      <!-- PONG -->
      <div class="game-wrap" id="tab-pong" role="tabpanel" aria-labelledby="Pong">
        <div class="canvas-wrap">
          <canvas id="pongCanvas" width="520" height="320"></canvas>
          <div class="hud">
            <span class="pill">T√∫: <strong id="pg-left">0</strong></span>
            <span class="pill">CPU: <strong id="pg-right">0</strong></span>
            <span class="pill">Velocidad: <strong id="pg-speed">1x</strong></span>
          </div>
          <div class="actions">
            <button class="btn" id="pg-restart">Reiniciar</button>
          </div>
          <div class="ctrls">Controles: ‚Üë / ‚Üì o W / S</div>
        </div>
      </div>

      <!-- BREAKOUT -->
      <div class="game-wrap" id="tab-breakout" role="tabpanel" aria-labelledby="Breakout">
        <div class="canvas-wrap">
          <canvas id="brCanvas" width="520" height="360"></canvas>
          <div class="hud">
            <span class="pill">Puntos: <strong id="br-score">0</strong></span>
            <span class="pill">Vidas: <strong id="br-lives">3</strong></span>
            <span class="pill">Nivel: <strong id="br-level">1</strong></span>
          </div>
          <div class="actions">
            <button class="btn" id="br-restart">Reiniciar</button>
          </div>
          <div class="ctrls">Controles: Mueve el mouse o ‚Üê ‚Üí</div>
        </div>
      </div>

      <!-- 2048 -->
      <div class="game-wrap" id="tab-2048" role="tabpanel" aria-labelledby="2048">
        <div class="canvas-wrap">
          <div class="grid-2048" id="grid2048"></div>
          <div class="hud">
            <span class="pill">Puntos: <strong id="g-score">0</strong></span>
            <span class="pill">Mejor: <strong id="g-best">0</strong></span>
          </div>
          <div class="actions">
            <button class="btn" id="g-restart">Reiniciar</button>
          </div>
          <div class="legend">Controles: Flechas o WASD ‚Äî combina n√∫meros iguales para llegar a 2048</div>
        </div>
      </div>
    </section>

    <footer>
      ¬© <span id="year"></span> Vision-Itaca ¬∑ Hecho con ‚ô• en modo previa.
    </footer>
  </div>

<script>
  // Utilidades generales
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
  const rng = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
  const storage = {
    get(k, def=0){ try { return JSON.parse(localStorage.getItem(k)) ?? def } catch { return def } },
    set(k, v){ try { localStorage.setItem(k, JSON.stringify(v)) } catch {} }
  };
  $('#year').textContent = new Date().getFullYear();

  // Tabs
  const tabBtns = $$('.tab-btn');
  const tabs = $$('.game-wrap');
  let inited = { snake:false, pong:false, breakout:false, g2048:false };
  tabBtns.forEach(btn => btn.addEventListener('click', () => {
    tabBtns.forEach(b => b.classList.toggle('active', b===btn));
    tabs.forEach(t => t.classList.toggle('active', t.id === 'tab-' + btn.dataset.tab));
    const key = btn.dataset.tab;
    if (!inited[key]) { inited[key] = true; initGame(key); }
  }));

  // Inicializar Snake por defecto
  window.addEventListener('load', () => { inited.snake = true; initGame('snake'); });

  function initGame(key){
    if (key==='snake') return initSnake();
    if (key==='pong') return initPong();
    if (key==='breakout') return initBreakout();
    if (key==='2048') return init2048();
  }

  /* ==================== SNAKE ==================== */
  function initSnake(){
    const canvas = $('#snakeCanvas');
    const ctx = canvas.getContext('2d');
    const grid = 20; // tama√±o celda
    const cols = Math.floor(canvas.width / grid);
    const rows = Math.floor(canvas.height / grid);
    let snake, dir, food, speed, score, best, paused, trail;

    function reset(){
      snake = [{x:Math.floor(cols/2), y:Math.floor(rows/2)}];
      dir = {x:1,y:0};
      food = spawnFood();
      speed = 8; // ticks/seg
      score = 0;
      trail = [];
      paused = false;
      $('#sn-score').textContent = score;
      $('#sn-speed').textContent = '1x';
      $('#sn-best').textContent = storage.get('sn-best', 0);
    }
    function spawnFood(){
      let f; do {
        f = {x: rng(0, cols-1), y: rng(0, rows-1)};
      } while (snake.some(s => s.x===f.x && s.y===f.y));
      return f;
    }
    function drawCell(x,y,color){
      ctx.fillStyle = color;
      const pad = 2;
      ctx.fillRect(x*grid+pad, y*grid+pad, grid-pad*2, grid-pad*2);
    }
    function step(){
      if (paused) return;
      // mover
      const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
      // paredes (wrap)
      head.x = (head.x + cols) % cols;
      head.y = (head.y + rows) % rows;
      // colisi√≥n cuerpo
      if (snake.some(s => s.x===head.x && s.y===head.y)) {
        flash('#ef444444');
        reset();
        return;
      }
      snake.unshift(head);
      if (head.x===food.x && head.y===food.y){
        score += 10; $('#sn-score').textContent = score;
        if (score % 50 === 0) { speed = Math.min(16, speed+1); $('#sn-speed').textContent = (speed/8).toFixed(1)+'x'; }
        food = spawnFood();
      } else {
        snake.pop();
      }
      // render
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // grid sutil
      ctx.globalAlpha = .07; ctx.strokeStyle = '#a78bfa';
      for(let x=0;x<cols;x++){ ctx.beginPath(); ctx.moveTo(x*grid,0); ctx.lineTo(x*grid,canvas.height); ctx.stroke() }
      for(let y=0;y<rows;y++){ ctx.beginPath(); ctx.moveTo(0,y*grid); ctx.lineTo(canvas.width,y*grid); ctx.stroke() }
      ctx.globalAlpha = 1;
      drawCell(food.x, food.y, '#7c3aed');
      snake.forEach((s,i)=> drawCell(s.x, s.y, i? '#c4b5fd' : '#a78bfa'));
      // best
      const best = Math.max(storage.get('sn-best',0), score); storage.set('sn-best', best); $('#sn-best').textContent = best;
    }
    function flash(color){
      canvas.style.boxShadow = `0 0 0 2px ${color}, inset 0 0 50px ${color}`;
      setTimeout(()=> canvas.style.boxShadow = '', 180);
    }
    function handleKey(e){
      const k = e.key.toLowerCase();
      if (k==='p') { paused = !paused; return }
      if ((k==='arrowup'||k==='w') && dir.y!==1) dir={x:0,y:-1};
      else if ((k==='arrowdown'||k==='s') && dir.y!==-1) dir={x:0,y:1};
      else if ((k==='arrowleft'||k==='a') && dir.x!==1) dir={x:-1,y:0};
      else if ((k==='arrowright'||k==='d') && dir.x!==-1) dir={x:1,y:0};
    }

    reset();
    document.addEventListener('keydown', handleKey);
    let acc=0; const fps=60;
    function loop(ts){ acc += 1; if (acc >= fps/speed){ acc=0; step(); } requestAnimationFrame(loop) }
    requestAnimationFrame(loop);
    $('#sn-restart').addEventListener('click', ()=> reset());
  }

  /* ==================== PONG ==================== */
  function initPong(){
    const canvas = $('#pongCanvas');
    const ctx = canvas.getContext('2d');
    let ball, left, right, speedMul, scoreL, scoreR, keys={};

    function reset(){
      ball = { x: canvas.width/2, y: canvas.height/2, vx: rng(0,1)?2.6:-2.6, vy: rng(-2,2), r: 6 };
      left = { x: 14, y: canvas.height/2-30, w: 8, h: 60, vy: 0 };
      right= { x: canvas.width-22, y: canvas.height/2-30, w: 8, h: 60 };
      speedMul = 1; scoreL = 0; scoreR = 0;
      $('#pg-left').textContent = scoreL; $('#pg-right').textContent = scoreR; $('#pg-speed').textContent = speedMul+'x';
    }
    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // middle line
      ctx.setLineDash([6, 8]); ctx.strokeStyle = '#a78bfa88'; ctx.beginPath(); ctx.moveTo(canvas.width/2,0); ctx.lineTo(canvas.width/2,canvas.height); ctx.stroke(); ctx.setLineDash([]);
      // paddles
      ctx.fillStyle = '#c4b5fd'; ctx.fillRect(left.x,left.y,left.w,left.h); ctx.fillRect(right.x,right.y,right.w,right.h);
      // ball
      ctx.beginPath(); ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2); ctx.fillStyle = '#a78bfa'; ctx.fill();
    }
    function step(){
      // input
      if (keys['arrowup']||keys['w']) left.y -= 4.2; if (keys['arrowdown']||keys['s']) left.y += 4.2;
      left.y = clamp(left.y, 6, canvas.height-left.h-6);
      // simple AI tracks ball with smoothing
      const target = ball.y - right.h/2; right.y += (target - right.y) * 0.08; right.y = clamp(right.y, 6, canvas.height-right.h-6);
      // move ball
      ball.x += ball.vx*speedMul; ball.y += ball.vy*speedMul;
      if (ball.y<6 || ball.y>canvas.height-6) ball.vy*=-1;
      // collisions
      function hit(p){ return ball.x-ball.r < p.x+p.w && ball.x+ball.r > p.x && ball.y+ball.r > p.y && ball.y-ball.r < p.y+p.h }
      if (hit(left)) { ball.vx = Math.abs(ball.vx)+0.2; const off=(ball.y-(left.y+left.h/2))/ (left.h/2); ball.vy = off*4; speedMul=Math.min(2.2, speedMul+0.03); }
      if (hit(right)){ ball.vx = -Math.abs(ball.vx)-0.2; const off=(ball.y-(right.y+right.h/2))/ (right.h/2); ball.vy = off*4; speedMul=Math.min(2.2, speedMul+0.03); }
      // score
      if (ball.x < -20){ scoreR++; $('#pg-right').textContent=scoreR; resetBall(-1); }
      if (ball.x > canvas.width+20){ scoreL++; $('#pg-left').textContent=scoreL; resetBall(1); }
      $('#pg-speed').textContent = speedMul.toFixed(1)+'x';
    }
    function resetBall(dir){ ball = { x: canvas.width/2, y: canvas.height/2, vx: 2.6*dir, vy: rng(-2,2), r: 6 }; speedMul = 1; }

    function loop(){ step(); draw(); requestAnimationFrame(loop) }
    window.addEventListener('keydown', e=> keys[e.key.toLowerCase()]=true);
    window.addEventListener('keyup', e=> keys[e.key.toLowerCase()]=false);
    reset(); loop();
    $('#pg-restart').addEventListener('click', reset);
  }

  /* ==================== BREAKOUT ==================== */
  function initBreakout(){
    const canvas = $('#brCanvas'); const ctx = canvas.getContext('2d');
    let paddle, ball, bricks, rows, cols, score, lives, level, running, keys={};

    function build(level){
      rows = clamp(3 + level, 3, 8); cols = 9; bricks=[];
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          bricks.push({ x: 24 + c* ( (canvas.width-48)/cols ), y: 40 + r*24, w: (canvas.width-48)/cols - 4, h: 16, hp: 1 + Math.floor(r/2) });
        }
      }
    }
    function reset(){
      paddle = { x: canvas.width/2-40, y: canvas.height-24, w: 80, h: 10, speed: 6 };
      ball = { x: canvas.width/2, y: canvas.height-60, r: 6, vx: 3.0, vy: -3.2 };
      score = 0; lives = 3; level = 1; running = true; build(level);
      $('#br-score').textContent = score; $('#br-lives').textContent = lives; $('#br-level').textContent = level;
    }
    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // paddle
      ctx.fillStyle = '#c4b5fd'; ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);
      // ball
      ctx.beginPath(); ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2); ctx.fillStyle = '#a78bfa'; ctx.fill();
      // bricks
      bricks.forEach(b=>{ if(b.hp<=0) return; ctx.globalAlpha = clamp(0.5 + b.hp*0.2, 0.5, 1); ctx.fillStyle = '#7c3aed'; ctx.fillRect(b.x,b.y,b.w,b.h); ctx.globalAlpha=1; });
    }
    function step(){
      // input
      if (keys['arrowleft']||keys['a']) paddle.x -= paddle.speed;
      if (keys['arrowright']||keys['d']) paddle.x += paddle.speed;
      paddle.x = clamp(paddle.x, 6, canvas.width - paddle.w - 6);
      // move ball
      ball.x += ball.vx; ball.y += ball.vy;
      if (ball.x<6||ball.x>canvas.width-6) ball.vx*=-1;
      if (ball.y<6) ball.vy*=-1;
      // paddle collision
      if (ball.y+ball.r>paddle.y && ball.x>paddle.x && ball.x<paddle.x+paddle.w && ball.vy>0){
        const hit = (ball.x - (paddle.x+paddle.w/2)) / (paddle.w/2);
        ball.vx = hit * 4.2; ball.vy = -Math.abs(ball.vy) - 0.1;
      }
      // bricks
      for (const b of bricks){
        if (b.hp<=0) continue;
        if (ball.x> b.x && ball.x< b.x+b.w && ball.y> b.y && ball.y< b.y+b.h){
          b.hp--; score+=10; $('#br-score').textContent=score;
          // bounce: choose axis by shortest overlap (simple)
          const left = Math.abs(ball.x - b.x), right = Math.abs(ball.x - (b.x+b.w)), top = Math.abs(ball.y - b.y), bottom = Math.abs(ball.y - (b.y+b.h));
          const min = Math.min(left,right,top,bottom);
          if (min===left || min===right) ball.vx*=-1; else ball.vy*=-1;
        }
      }
      // bottom
      if (ball.y > canvas.height+10){ lives--; $('#br-lives').textContent=lives; ball.x=canvas.width/2; ball.y=canvas.height-60; ball.vx=3.0; ball.vy=-3.2; }
      if (lives<=0){ reset(); }
      // next level
      if (bricks.every(b=> b.hp<=0)){ level++; $('#br-level').textContent=level; build(level); ball.x=canvas.width/2; ball.y=canvas.height-60; ball.vx=3.0; ball.vy=-3.2; }
    }
    function loop(){ if(!running) return; step(); draw(); requestAnimationFrame(loop) }
    window.addEventListener('mousemove', e=>{ const rect=canvas.getBoundingClientRect(); if (document.activeElement!==canvas) return; paddle.x = clamp(e.clientX-rect.left - paddle.w/2, 6, canvas.width - paddle.w - 6); });
    window.addEventListener('keydown', e=> keys[e.key.toLowerCase()]=true);
    window.addEventListener('keyup', e=> keys[e.key.toLowerCase()]=false);
    $('#br-restart').addEventListener('click', reset);
    reset(); loop();
  }

  /* ==================== 2048 ==================== */
  function init2048(){
    const gridEl = $('#grid2048');
    const scoreEl = $('#g-score'); const bestEl = $('#g-best');
    let board, score, best;

    function emptyBoard(){ return Array.from({length:4}, ()=> Array(4).fill(0)); }
    function draw(){
      gridEl.innerHTML = '';
      for (let r=0;r<4;r++){
        for (let c=0;c<4;c++){
          const v = board[r][c];
          const cell = document.createElement('div'); cell.className='cell';
          cell.textContent = v? v : '';
          const hue = 265; // violet
          const sat = v? clamp(35 + Math.log2(v)*8, 35, 95) : 28;
          const light = v? clamp(22 + Math.log2(v)*4, 22, 65) : 20;
          cell.style.background = v? `hsl(${hue} ${sat}% ${light}%)` : '';
          cell.style.borderColor = 'rgba(167,139,250,.25)';
          gridEl.appendChild(cell);
        }
      }
      scoreEl.textContent = score; best = Math.max(best, score); bestEl.textContent = best; storage.set('g-best', best);
    }
    function addTile(){
      const empties = [];
      for (let r=0;r<4;r++) for(let c=0;c<4;c++) if (!board[r][c]) empties.push([r,c]);
      if (!empties.length) return false;
      const [r,c] = empties[Math.floor(Math.random()*empties.length)];
      board[r][c] = Math.random()<0.9? 2 : 4; return true;
    }
    function compress(row){
      const nonzero = row.filter(v=>v); const out = []; let merged=false;
      for(let i=0;i<nonzero.length;i++){
        if (nonzero[i+1] && nonzero[i]===nonzero[i+1]){ out.push(nonzero[i]*2); score += nonzero[i]*2; i++; merged=true; }
        else out.push(nonzero[i]);
      }
      while(out.length<4) out.push(0);
      return {row: out, moved: merged || out.some((v,i)=> v!==row[i])};
    }
    function rotate(times){ // rotate board 90deg clockwise times
      for(let t=0;t<times;t++){
        const nb = emptyBoard();
        for(let r=0;r<4;r++) for(let c=0;c<4;c++) nb[c][3-r]=board[r][c];
        board = nb;
      }
    }
    function move(dir){ // 0 left, 1 up, 2 right, 3 down
      // rotate so we always move left
      rotate(dir);
      let moved=false; for(let r=0;r<4;r++){ const res=compress(board[r]); board[r]=res.row; moved = moved || res.moved; }
      rotate((4-dir)%4);
      if (moved){ addTile(); draw(); if (isGameOver()) setTimeout(()=> start(), 650); }
    }
    function isGameOver(){
      for(let r=0;r<4;r++) for(let c=0;c<4;c++) if(!board[r][c]) return false;
      // check merges
      for(let r=0;r<4;r++) for(let c=0;c<4;c++){
        const v=board[r][c];
        if ((board[r+1]?.[c]===v) || (board[r]?.[c+1]===v)) return false;
      }
      return true;
    }
    function start(){
      board = emptyBoard(); score = 0; best = storage.get('g-best', 0); addTile(); addTile(); draw();
    }
    window.addEventListener('keydown', e=>{
      const k=e.key.toLowerCase(); if(['arrowleft','a'].includes(k)) move(0);
      if(['arrowup','w'].includes(k)) move(1);
      if(['arrowright','d'].includes(k)) move(2);
      if(['arrowdown','s'].includes(k)) move(3);
    });
    $('#g-restart').addEventListener('click', start);
    start();
  }
</script>
</body>
</html>
